<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="djvdj">
<title>Clonotype Frequencies • djvdj</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.7/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.7/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Clonotype Frequencies">
<meta property="og:description" content="djvdj">
<meta property="og:image" content="https://rnabioco.github.io/djvdj/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="rnabioco.github.io" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">djvdj</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Data import and manipulation</h6>
    <a class="dropdown-item" href="../articles/import.html">Data Import</a>
    <a class="dropdown-item" href="../articles/mutate.html">Data Manipulation</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>VDJ analysis</h6>
    <a class="dropdown-item" href="../articles/frequency.html">Clonotype Frequencies</a>
    <a class="dropdown-item" href="../articles/diversity.html">Repertoire Diversity</a>
    <a class="dropdown-item" href="../articles/similarity.html">Repertoire Similarity</a>
    <a class="dropdown-item" href="../articles/gene-usage.html">Gene Usage</a>
    <a class="dropdown-item" href="../articles/clustering.html">CDR3 Clustering</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Visualization</h6>
    <a class="dropdown-item" href="../articles/plotting.html">Plotting</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rnabioco/djvdj/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Clonotype Frequencies</h1>
            
            <h4 data-toc-skip class="date">October 01 2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rnabioco/djvdj/blob/HEAD/vignettes/frequency.Rmd" class="external-link"><code>vignettes/frequency.Rmd</code></a></small>
      <div class="d-none name"><code>frequency.Rmd</code></div>
    </div>

    
    
<p><br></p>
<p>This vignette provides detailed examples for quantifying differences
in clonotype frequencies. For the examples shown below, we use data for
splenocytes from BL6 and MD4 mice collected using the 10X Genomics
scRNA-seq platform. MD4 B cells are monoclonal and specifically bind hen
egg lysozyme.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rnabioco.github.io/djvdj/">djvdj</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load GEX data</span></span>
<span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/splen"</span>, package <span class="op">=</span> <span class="st">"djvdj"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gex_dirs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  BL6 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"BL6_GEX/filtered_feature_bc_matrix"</span><span class="op">)</span>,</span>
<span>  MD4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"MD4_GEX/filtered_feature_bc_matrix"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">so</span> <span class="op">&lt;-</span> <span class="va">gex_dirs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://satijalab.org/seurat/reference/Read10X.html" class="external-link">Read10X</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/CreateSeuratObject.html" class="external-link">CreateSeuratObject</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/AddMetaData.html" class="external-link">AddMetaData</a></span><span class="op">(</span><span class="va">splen_meta</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add V(D)J data to object</span></span>
<span><span class="va">vdj_dirs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  BL6 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/splen/BL6_BCR"</span>, package <span class="op">=</span> <span class="st">"djvdj"</span><span class="op">)</span>,</span>
<span>  MD4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/splen/MD4_BCR"</span>, package <span class="op">=</span> <span class="st">"djvdj"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">so</span> <span class="op">&lt;-</span> <span class="va">so</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/import_vdj.html">import_vdj</a></span><span class="op">(</span><span class="va">vdj_dirs</span>, define_clonotypes <span class="op">=</span> <span class="st">"cdr3_gene"</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<div class="section level2">
<h2 id="calculating-clonotype-frequencies">Calculating clonotype frequencies<a class="anchor" aria-label="anchor" href="#calculating-clonotype-frequencies"></a>
</h2>
<p>To quantify clonotype frequencies and store the results in the object
meta.data, the <code><a href="../reference/calc_frequency.html">calc_frequency()</a></code> function can be used. This
will add columns showing the number of occurrences of each clonotype
(‘freq’), the percentage of cells sharing the clonotype (‘pct’), and a
label that can be used for plotting (‘grp’). By default these
calculations will be performed for all cells in the object.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">so_vdj</span> <span class="op">&lt;-</span> <span class="va">so</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_frequency.html">calc_frequency</a></span><span class="op">(</span>data_col <span class="op">=</span> <span class="st">"clonotype_id"</span><span class="op">)</span></span></code></pre></div>
<p>To calculate clonotype frequencies separately for samples or
clusters, the <code>cluster_col</code> argument can be used. To do this
just specify the name of the column containing the sample or cluster IDs
for each cell.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">so_vdj</span> <span class="op">&lt;-</span> <span class="va">so</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_frequency.html">calc_frequency</a></span><span class="op">(</span></span>
<span>    data_col <span class="op">=</span> <span class="st">"clonotype_id"</span>,</span>
<span>    cluster_col <span class="op">=</span> <span class="st">"sample"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>When <code>cluster_col</code> is specified, an additional meta.data
column (‘shared’) will be added indicating whether the clonotype is
shared between multiple clusters.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">so_vdj</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/methods/slot.html" class="external-link">slot</a></span><span class="op">(</span><span class="st">"meta.data"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;                        orig.ident nCount_RNA nFeature_RNA RNA_snn_res.1</span></span>
<span><span class="co">#&gt; BL6_AAACGGGGTTCTGTTT-1        BL6        202           25             0</span></span>
<span><span class="co">#&gt; BL6_AAAGATGCAACAACCT-1        BL6         42           20             3</span></span>
<span><span class="co">#&gt;                        seurat_clusters     UMAP_1     UMAP_2</span></span>
<span><span class="co">#&gt; BL6_AAACGGGGTTCTGTTT-1               0 -1.7410439  0.8840749</span></span>
<span><span class="co">#&gt; BL6_AAAGATGCAACAACCT-1               3  0.9088528 -1.2614110</span></span>
<span><span class="co">#&gt;                                  type         r cell_type sample</span></span>
<span><span class="co">#&gt; BL6_AAACGGGGTTCTGTTT-1 B cells (B.T3) 0.6256432   B cells  BL6-1</span></span>
<span><span class="co">#&gt; BL6_AAAGATGCAACAACCT-1 B cells (B.T2) 0.6350011   B cells  BL6-1</span></span>
<span><span class="co">#&gt;                        exact_subclonotype_id chains n_chains        cdr3</span></span>
<span><span class="co">#&gt; BL6_AAACGGGGTTCTGTTT-1                    NA   &lt;NA&gt;       NA        &lt;NA&gt;</span></span>
<span><span class="co">#&gt; BL6_AAAGATGCAACAACCT-1                     1    IGK        1 CFQGSHVPWTF</span></span>
<span><span class="co">#&gt;                                                  cdr3_nt cdr3_length</span></span>
<span><span class="co">#&gt; BL6_AAACGGGGTTCTGTTT-1                              &lt;NA&gt;        &lt;NA&gt;</span></span>
<span><span class="co">#&gt; BL6_AAAGATGCAACAACCT-1 TGCTTTCAAGGTTCACATGTTCCGTGGACGTTC          11</span></span>
<span><span class="co">#&gt;                        cdr3_nt_length    v_gene d_gene j_gene c_gene</span></span>
<span><span class="co">#&gt; BL6_AAACGGGGTTCTGTTT-1           &lt;NA&gt;      &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; BL6_AAAGATGCAACAACCT-1             33 IGKV1-117   None  IGKJ1   IGKC</span></span>
<span><span class="co">#&gt;                        isotype reads umis productive full_length paired</span></span>
<span><span class="co">#&gt; BL6_AAACGGGGTTCTGTTT-1    &lt;NA&gt;  &lt;NA&gt; &lt;NA&gt;       &lt;NA&gt;        &lt;NA&gt;     NA</span></span>
<span><span class="co">#&gt; BL6_AAAGATGCAACAACCT-1    None   352   21       TRUE        TRUE  FALSE</span></span>
<span><span class="co">#&gt;                        clonotype_id n_cells clonotype_id_freq</span></span>
<span><span class="co">#&gt; BL6_AAACGGGGTTCTGTTT-1         &lt;NA&gt;      NA                NA</span></span>
<span><span class="co">#&gt; BL6_AAAGATGCAACAACCT-1  clonotype34      55                 1</span></span>
<span><span class="co">#&gt;                        clonotype_id_pct clonotype_id_shared</span></span>
<span><span class="co">#&gt; BL6_AAACGGGGTTCTGTTT-1               NA                  NA</span></span>
<span><span class="co">#&gt; BL6_AAAGATGCAACAACCT-1         1.818182                TRUE</span></span>
<span><span class="co">#&gt;                        clonotype_id_grp</span></span>
<span><span class="co">#&gt; BL6_AAACGGGGTTCTGTTT-1             &lt;NA&gt;</span></span>
<span><span class="co">#&gt; BL6_AAAGATGCAACAACCT-1                1</span></span></code></pre></div>
<p><br></p>
</div>
<div class="section level2">
<h2 id="plotting-clonotype-frequencies">Plotting clonotype frequencies<a class="anchor" aria-label="anchor" href="#plotting-clonotype-frequencies"></a>
</h2>
<p>djvdj includes the <code><a href="../reference/plot_clone_frequency.html">plot_clone_frequency()</a></code> function to
visualize differences in clonotype frequency between samples or
clusters. By default this will produce bargraphs. Plot colors can be
adjusted using the <code>plot_colors</code> argument.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">so</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/plot_clone_frequency.html">plot_clone_frequency</a></span><span class="op">(</span></span>
<span>    data_col <span class="op">=</span> <span class="st">"clonotype_id"</span>,</span>
<span>    plot_colors <span class="op">=</span> <span class="st">"#3182bd"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="frequency_files/figure-html/unnamed-chunk-5-1.png" width="768"></p>
<p>Frequencies can be calculated and plotted separately for each sample
or cluster using the <code>cluster_col</code> argument. The
<code>panel_nrow</code> and <code>panel_scales</code> arguments can be
used to add separate scales for each sample or to adjust the number of
rows used to arrange plots.</p>
<p>As expected we see that most MD4 B cells share the same clonotype,
while BL6 cells have a diverse repertoire.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">so</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/plot_clone_frequency.html">plot_clone_frequency</a></span><span class="op">(</span></span>
<span>    data_col     <span class="op">=</span> <span class="st">"clonotype_id"</span>,</span>
<span>    cluster_col  <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>    panel_scales <span class="op">=</span> <span class="st">"free"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="frequency_files/figure-html/unnamed-chunk-6-1.png" width="768"></p>
<p>Rank-abundance plots can also be generated by setting the
<code>method</code> argument to ‘line’. Most djvdj plotting functions
return ggplot objects that can be further modified with ggplot2
functions. Here we further modify plot aesthetics using the
<code>ggplot::theme()</code> function. Most djvdj plotting function also
include the ability to transform the axis using the <code>trans</code>
argument.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">so</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/plot_clone_frequency.html">plot_clone_frequency</a></span><span class="op">(</span></span>
<span>    data_col    <span class="op">=</span> <span class="st">"clonotype_id"</span>,</span>
<span>    cluster_col <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>    method      <span class="op">=</span> <span class="st">"line"</span>,</span>
<span>    plot_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>MD4 <span class="op">=</span> <span class="st">"#fec44f"</span>, BL6 <span class="op">=</span> <span class="st">"#3182bd"</span><span class="op">)</span>,</span>
<span>    trans       <span class="op">=</span> <span class="st">"log10"</span>         <span class="co"># log-transform axis</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="frequency_files/figure-html/unnamed-chunk-7-1.png" width="768"></p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="umap-projections">UMAP projections<a class="anchor" aria-label="anchor" href="#umap-projections"></a>
</h2>
<p>By default <code><a href="../reference/calc_frequency.html">calc_frequency()</a></code> will divide clonotypes into
groups based on frequency and add a column to the meta.data containing
these group labels. Clonotype frequencies can be summarized on a UMAP
projection by plotting the added ‘grp’ column using the generic plotting
function <code><a href="../reference/plot_scatter.html">plot_scatter()</a></code>.</p>
<p>Cells that lack BCR data will be plotted as <code>NA</code>s, the
color of these points can be adjusted using the <code>na_color</code>
argument.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create UMAP summarizing samples</span></span>
<span><span class="va">mouse_gg</span> <span class="op">&lt;-</span> <span class="va">so</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/plot_scatter.html">plot_scatter</a></span><span class="op">(</span>data_col <span class="op">=</span> <span class="st">"orig.ident"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create UMAP summarizing clonotype frequencies</span></span>
<span><span class="va">abun_gg</span> <span class="op">&lt;-</span> <span class="va">so</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_frequency.html">calc_frequency</a></span><span class="op">(</span></span>
<span>    data_col <span class="op">=</span> <span class="st">"clonotype_id"</span>,</span>
<span>    cluster_col <span class="op">=</span> <span class="st">"sample"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/plot_scatter.html">plot_scatter</a></span><span class="op">(</span>data_col <span class="op">=</span> <span class="st">"clonotype_id_grp"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mouse_gg</span> <span class="op">+</span> <span class="va">abun_gg</span></span></code></pre></div>
<p><img src="frequency_files/figure-html/unnamed-chunk-8-1.png" width="1056"></p>
<p>Highly abundant clonotypes can also be specifically labeled on a UMAP
projection. To do this, pass a vector of top clonotypes to highlight to
the <code>top</code> argument of <code><a href="../reference/plot_scatter.html">plot_scatter()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">top_gg</span> <span class="op">&lt;-</span> <span class="va">so</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/plot_scatter.html">plot_scatter</a></span><span class="op">(</span></span>
<span>    data_col    <span class="op">=</span> <span class="st">"clonotype_id"</span>,</span>
<span>    top         <span class="op">=</span> <span class="st">"clonotype56"</span>,</span>
<span>    plot_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>other <span class="op">=</span> <span class="st">"#fec44f"</span>, clonotype56 <span class="op">=</span> <span class="st">"#3182bd"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">mouse_gg</span> <span class="op">+</span> <span class="va">top_gg</span></span></code></pre></div>
<p><img src="frequency_files/figure-html/unnamed-chunk-9-1.png" width="1056"></p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="other-frequency-calculations">Other frequency calculations<a class="anchor" aria-label="anchor" href="#other-frequency-calculations"></a>
</h2>
<p>In addition to clonotype abundance, <code><a href="../reference/calc_frequency.html">calc_frequency()</a></code> can
be used to summarize the frequency of any cell label present in the
object. In this example we count the number of cells present for each
cell type in each sample.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">so_vdj</span> <span class="op">&lt;-</span> <span class="va">so</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_frequency.html">calc_frequency</a></span><span class="op">(</span></span>
<span>    data_col <span class="op">=</span> <span class="st">"cell_type"</span>,</span>
<span>    cluster_col <span class="op">=</span> <span class="st">"sample"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>To plot the fraction of cells present for each cell type, we can use
the generic plotting function, <code><a href="../reference/plot_frequency.html">plot_frequency()</a></code>. This will
create stacked bargraphs summarizing each cell label present in the
<code>data_col</code> column. The color of each group can be specified
with the <code>plot_colors</code> argument.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">so</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/plot_frequency.html">plot_frequency</a></span><span class="op">(</span></span>
<span>    data_col    <span class="op">=</span> <span class="st">"cell_type"</span>,</span>
<span>    cluster_col <span class="op">=</span> <span class="st">"sample"</span>,</span>
<span>    plot_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#3182bd"</span>, <span class="st">"#fec44f"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="frequency_files/figure-html/unnamed-chunk-11-1.png" width="768"></p>
<p>To summarize the number cells present for each cell type, set the
<code>units</code> argument to ‘frequency’. To create grouped bargraphs,
set the <code>stack</code> argument to <code>FALSE</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">so</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/plot_frequency.html">plot_frequency</a></span><span class="op">(</span></span>
<span>    data_col    <span class="op">=</span> <span class="st">"cell_type"</span>,</span>
<span>    cluster_col <span class="op">=</span> <span class="st">"sample"</span>,</span>
<span>    units       <span class="op">=</span> <span class="st">"frequency"</span>,</span>
<span>    stack       <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="frequency_files/figure-html/unnamed-chunk-12-1.png" width="768"></p>
<p>Clusters can also be grouped based on an additional variable such as
treatment group (e.g. placebo vs drug) or disease status (e.g. healthy
vs disease). This will generate bargraphs (or boxplots) showing the mean
and standard deviation for each group. In this example we are comparing
the 3 BL6 and 3 MD4 samples. You will also notice that there is a group
labeled as <code>NA</code>, these are cells that lacked V(D)J data and
thus did not have an assigned isotype.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">so</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/plot_frequency.html">plot_frequency</a></span><span class="op">(</span></span>
<span>    data_col    <span class="op">=</span> <span class="st">"isotype"</span>,</span>
<span>    cluster_col <span class="op">=</span> <span class="st">"sample"</span>,</span>
<span>    group_col   <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>    plot_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>MD4 <span class="op">=</span> <span class="st">"#fec44f"</span>, BL6 <span class="op">=</span> <span class="st">"#3182bd"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="frequency_files/figure-html/unnamed-chunk-13-1.png" width="480"></p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="p-values">p-values<a class="anchor" aria-label="anchor" href="#p-values"></a>
</h2>
<p>p-values can be calculated and shown on plots generated by
<code><a href="../reference/plot_frequency.html">plot_frequency()</a></code> and <code><a href="../reference/plot_gene_usage.html">plot_gene_usage()</a></code>. To do
this, you must pass a grouping variable to the <code>group_col</code>
argument, which is used to group the clusters found in
<code>cluster_col</code>. This is best used when you have a set of
samples that can be divided into distinct groups. The cluster names
should be unique for each treatment group, e.g. healthy: healthy-1,
healthy-2; disease: disease-1, disease-2.</p>
<p>The method used to calculate p-values can be specified with the
<code>p_method</code> argument. By default a t-test will be performed,
if more than two groups are compared the Kruskal-Wallis test will be
used. A summary table of the calculated p-values can also be saved by
passing a path to the <code>p_file</code> argument.</p>
<p>The <code>p_label</code> argument can be used to modify which
p-values are shown on the plot, by default only significant p-values are
shown. In this example we display all p-values calculated using a
t-test.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">so</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/plot_frequency.html">plot_frequency</a></span><span class="op">(</span></span>
<span>    data_col    <span class="op">=</span> <span class="st">"isotype"</span>,</span>
<span>    cluster_col <span class="op">=</span> <span class="st">"sample"</span>,</span>
<span>    group_col   <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>    </span>
<span>    p_label     <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>    p_method    <span class="op">=</span> <span class="st">"t"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="frequency_files/figure-html/unnamed-chunk-14-1.png" width="768"></p>
<p>Custom labels for different p-value cutoffs can be specified by
passing a named vector to the <code>p_label</code> argument. To display
the actual p-value when it is below a certain threshold, use the keyword
‘value’. Symbols can also be displayed by including the unicode symbol
code. In this example we display p-values &lt;0.05, print a soccer ball
for &lt;0.1, and all others are labeled as ‘ns’.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">so</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/plot_frequency.html">plot_frequency</a></span><span class="op">(</span></span>
<span>    data_col    <span class="op">=</span> <span class="st">"isotype"</span>,</span>
<span>    cluster_col <span class="op">=</span> <span class="st">"sample"</span>,</span>
<span>    group_col   <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>    p_label     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fl">0.05</span>, <span class="st">"\\u26BD"</span> <span class="op">=</span> <span class="fl">0.1</span>, ns <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="frequency_files/figure-html/unnamed-chunk-15-1.png" width="768"></p>
<p>Label aesthetics can be modified by passing a named list of aesthetic
parameters to the <code>label_params</code> argument. These parameters
will also modify the n-label, to specifically modify the p-value label,
prefix each parameter with ‘p.’, e.g. <code>p.size = 14</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">so</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/plot_frequency.html">plot_frequency</a></span><span class="op">(</span></span>
<span>    data_col     <span class="op">=</span> <span class="st">"isotype"</span>,</span>
<span>    cluster_col  <span class="op">=</span> <span class="st">"sample"</span>,</span>
<span>    group_col    <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>    n_label      <span class="op">=</span> <span class="st">"corner"</span>,</span>
<span>    label_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>p.color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="frequency_files/figure-html/unnamed-chunk-16-1.png" width="768"></p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="session-info">Session info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<pre><code><span><span class="co">#&gt; R version 4.3.1 (2023-06-16)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 22.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] ggplot2_3.4.3      SeuratObject_4.1.4 Seurat_4.4.0      </span></span>
<span><span class="co">#&gt; [4] djvdj_0.1.0       </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;   [1] RColorBrewer_1.1-3     jsonlite_1.8.7         magrittr_2.0.3        </span></span>
<span><span class="co">#&gt;   [4] spatstat.utils_3.0-3   farver_2.1.1           rmarkdown_2.25        </span></span>
<span><span class="co">#&gt;   [7] fs_1.6.3               ragg_1.2.5             vctrs_0.6.3           </span></span>
<span><span class="co">#&gt;  [10] ROCR_1.0-11            memoise_2.0.1          spatstat.explore_3.2-3</span></span>
<span><span class="co">#&gt;  [13] htmltools_0.5.6        sass_0.4.7             sctransform_0.4.0     </span></span>
<span><span class="co">#&gt;  [16] parallelly_1.36.0      KernSmooth_2.23-21     bslib_0.5.1           </span></span>
<span><span class="co">#&gt;  [19] htmlwidgets_1.6.2      desc_1.4.2             ica_1.0-3             </span></span>
<span><span class="co">#&gt;  [22] plyr_1.8.8             plotly_4.10.2          zoo_1.8-12            </span></span>
<span><span class="co">#&gt;  [25] cachem_1.0.8           igraph_1.5.1           mime_0.12             </span></span>
<span><span class="co">#&gt;  [28] lifecycle_1.0.3        pkgconfig_2.0.3        Matrix_1.6-1.1        </span></span>
<span><span class="co">#&gt;  [31] R6_2.5.1               fastmap_1.1.1          fitdistrplus_1.1-11   </span></span>
<span><span class="co">#&gt;  [34] future_1.33.0          shiny_1.7.5            digest_0.6.33         </span></span>
<span><span class="co">#&gt;  [37] colorspace_2.1-0       patchwork_1.1.3        rprojroot_2.0.3       </span></span>
<span><span class="co">#&gt;  [40] tensor_1.5             irlba_2.3.5.1          textshaping_0.3.6     </span></span>
<span><span class="co">#&gt;  [43] labeling_0.4.3         progressr_0.14.0       fansi_1.0.4           </span></span>
<span><span class="co">#&gt;  [46] spatstat.sparse_3.0-2  httr_1.4.7             polyclip_1.10-6       </span></span>
<span><span class="co">#&gt;  [49] abind_1.4-5            compiler_4.3.1         bit64_4.0.5           </span></span>
<span><span class="co">#&gt;  [52] withr_2.5.1            MASS_7.3-60            tools_4.3.1           </span></span>
<span><span class="co">#&gt;  [55] lmtest_0.9-40          httpuv_1.6.11          future.apply_1.11.0   </span></span>
<span><span class="co">#&gt;  [58] goftest_1.2-3          glue_1.6.2             nlme_3.1-162          </span></span>
<span><span class="co">#&gt;  [61] promises_1.2.1         grid_4.3.1             Rtsne_0.16            </span></span>
<span><span class="co">#&gt;  [64] cluster_2.1.4          reshape2_1.4.4         generics_0.1.3        </span></span>
<span><span class="co">#&gt;  [67] gtable_0.3.4           spatstat.data_3.0-1    tzdb_0.4.0            </span></span>
<span><span class="co">#&gt;  [70] tidyr_1.3.0            data.table_1.14.8      hms_1.1.3             </span></span>
<span><span class="co">#&gt;  [73] sp_2.0-0               utf8_1.2.3             spatstat.geom_3.2-5   </span></span>
<span><span class="co">#&gt;  [76] RcppAnnoy_0.0.21       ggrepel_0.9.3          RANN_2.6.1            </span></span>
<span><span class="co">#&gt;  [79] pillar_1.9.0           stringr_1.5.0          vroom_1.6.3           </span></span>
<span><span class="co">#&gt;  [82] later_1.3.1            splines_4.3.1          dplyr_1.1.3           </span></span>
<span><span class="co">#&gt;  [85] lattice_0.21-8         bit_4.0.5              survival_3.5-5        </span></span>
<span><span class="co">#&gt;  [88] deldir_1.0-9           tidyselect_1.2.0       miniUI_0.1.1.1        </span></span>
<span><span class="co">#&gt;  [91] pbapply_1.7-2          knitr_1.44             gridExtra_2.3         </span></span>
<span><span class="co">#&gt;  [94] scattermore_1.2        xfun_0.40              matrixStats_1.0.0     </span></span>
<span><span class="co">#&gt;  [97] stringi_1.7.12         lazyeval_0.2.2         yaml_2.3.7            </span></span>
<span><span class="co">#&gt; [100] evaluate_0.21          codetools_0.2-19       tibble_3.2.1          </span></span>
<span><span class="co">#&gt; [103] cli_3.6.1              uwot_0.1.16            xtable_1.8-4          </span></span>
<span><span class="co">#&gt; [106] reticulate_1.32.0      systemfonts_1.0.4      munsell_0.5.0         </span></span>
<span><span class="co">#&gt; [109] jquerylib_0.1.4        Rcpp_1.0.11            globals_0.16.2        </span></span>
<span><span class="co">#&gt; [112] spatstat.random_3.1-6  png_0.1-8              parallel_4.3.1        </span></span>
<span><span class="co">#&gt; [115] ellipsis_0.3.2         pkgdown_2.0.7          readr_2.1.4           </span></span>
<span><span class="co">#&gt; [118] listenv_0.9.0          viridisLite_0.4.2      scales_1.2.1          </span></span>
<span><span class="co">#&gt; [121] ggridges_0.5.4         crayon_1.5.2           leiden_0.4.3          </span></span>
<span><span class="co">#&gt; [124] purrr_1.0.2            rlang_1.1.1            cowplot_1.1.1</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>An R package developed by the <a href="https://medschool.cuanschutz.edu/rbi" class="external-link">RNA Bioscience Initiative</a></p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
